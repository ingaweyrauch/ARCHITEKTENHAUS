
    
    <script type="module">
        // Firebase-Konfiguration
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, query, orderBy, serverTimestamp, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDRa7bc6HzxI7qx1cgF5EWlgn-cyCmLahQ",
            authDomain: "architektenhaus-am-wald.firebaseapp.com",
            projectId: "architektenhaus-am-wald",
            storageBucket: "architektenhaus-am-wald.firebasestorage.app",
            messagingSenderId: "703193723384",
            appId: "1:703193723384:web:e2f70ddda635e265e2e60d",
            measurementId: "G-YHREGR7KLH"
        };

        // Firebase initialisieren
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        
        // ADMIN CREDENTIALS
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'architektenhaus2025'
        };
        
        // DOM Elements
        const loginContainer = document.getElementById('loginContainer');
        const adminDashboard = document.getElementById('adminDashboard');
        const loginForm = document.getElementById('loginForm');
        const loginErrorMessage = document.getElementById('loginErrorMessage');
        const logoutBtn = document.getElementById('logoutBtn');
        const navLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Global variables
        let currentBookings = [];
        let currentFeatures = [];
        let currentGalleryImages = [];
        
        // LOGIN FUNCTIONALITY
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                loginContainer.style.display = 'none';
                adminDashboard.classList.add('active');
                
                // Load dashboard data
                loadDashboardData();
                
                // Store login state
                sessionStorage.setItem('adminLoggedIn', 'true');
            } else {
                loginErrorMessage.textContent = 'Ung√ºltige Anmeldedaten';
            }
        });
        
        // LOGOUT FUNCTIONALITY
        logoutBtn.addEventListener('click', function() {
            adminDashboard.classList.remove('active');
            loginContainer.style.display = 'flex';
            
            // Clear form
            loginForm.reset();
            loginErrorMessage.textContent = '';
            
            // Remove login state
            sessionStorage.removeItem('adminLoggedIn');
        });
        
        // Check login state on page load
        if (sessionStorage.getItem('adminLoggedIn') === 'true') {
            loginContainer.style.display = 'none';
            adminDashboard.classList.add('active');
            loadDashboardData();
        }
        
        // TAB NAVIGATION
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all tabs and contents
                navLinks.forEach(l => l.classList.remove('active'));
                tabContents.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                this.classList.add('active');
                
                // Show corresponding content
                const targetId = this.getAttribute('href').substring(1);
                const targetContent = document.getElementById(targetId);
                if (targetContent) {
                    targetContent.classList.add('active');
                    
                    // Load data based on tab
                    switch(targetId) {
                        case 'dashboard':
                            loadDashboardData();
                            break;
                        case 'bookings':
                            loadBookings();
                            break;
                        case 'content':
                            loadContentData();
                            break;
                        case 'gallery':
                            loadGalleryData();
                            break;
                        case 'features':
                            loadFeaturesData();
                            break;
                    }
                }
            });
        });
        
        // DASHBOARD FUNCTIONS
        async function loadDashboardData() {
            try {
                console.log('üìä Lade Dashboard Daten...');
                
                // Load statistics
                const bookingsSnapshot = await getDocs(collection(db, 'bookings'));
                const gallerySnapshot = await getDocs(collection(db, 'gallery'));
                const featuresSnapshot = await getDocs(collection(db, 'features'));
                
                // Update current bookings for global access
                currentBookings = bookingsSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                console.log('üìÖ Aktuelle Buchungen geladen:', currentBookings.length);
                
                const totalBookings = bookingsSnapshot.size;
                const pendingBookings = bookingsSnapshot.docs.filter(doc => doc.data().status === 'pending').length;
                const confirmedBookings = bookingsSnapshot.docs.filter(doc => doc.data().status === 'confirmed').length;
                const cancelledBookings = bookingsSnapshot.docs.filter(doc => doc.data().status === 'cancelled').length;
                
                const totalBookingsEl = document.getElementById('totalBookings');
                const pendingBookingsEl = document.getElementById('pendingBookings');
                const confirmedBookingsEl = document.getElementById('confirmedBookings');
                const cancelledBookingsEl = document.getElementById('cancelledBookings');
                
                if (totalBookingsEl) totalBookingsEl.textContent = totalBookings;
                if (pendingBookingsEl) pendingBookingsEl.textContent = pendingBookings;
                if (confirmedBookingsEl) confirmedBookingsEl.textContent = confirmedBookings;
                if (cancelledBookingsEl) cancelledBookingsEl.textContent = cancelledBookings;
                
                // Load recent bookings
                const recentBookings = currentBookings
                    .sort((a, b) => {
                        const aTime = a.timestamp?.toDate ? a.timestamp.toDate() : new Date(a.timestamp || 0);
                        const bTime = b.timestamp?.toDate ? b.timestamp.toDate() : new Date(b.timestamp || 0);
                        return bTime - aTime;
                    })
                    .slice(0, 5);
                
                displayRecentBookings(recentBookings);
                
                console.log('‚úÖ Dashboard Daten erfolgreich geladen');
                
            } catch (error) {
                console.error('‚ùå Fehler beim Laden der Dashboard Daten:', error);
                alert('Fehler beim Laden der Dashboard Daten: ' + error.message);
            }
        }
        
        function displayRecentBookings(bookings) {
            const tableBody = document.getElementById('recentBookingsTable');
            
            if (bookings.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Keine Buchungen vorhanden</td></tr>';
                return;
            }
            
            tableBody.innerHTML = bookings.map(booking => {
                const date = booking.timestamp?.toDate().toLocaleDateString('de-DE') || 'Unbekannt';
                const statusClass = booking.status === 'pending' ? 'status-pending' : 
                                  booking.status === 'confirmed' ? 'status-confirmed' : 'status-cancelled';
                
                const personenText = `${booking.erwachsene || 0}E + ${booking.kinder || 0}K`;
                
                return `
                    <tr>
                        <td>${date}</td>
                        <td>${booking.vorname} ${booking.nachname}</td>
                        <td>${booking.email}</td>
                        <td>${booking.anreise} - ${booking.abreise} (${booking.naechte || 'N/A'} N√§chte)</td>
                        <td>${personenText}</td>
                        <td>‚Ç¨${booking.gesamtpreis || 'N/A'}</td>
                        <td><span class="status-badge ${statusClass}">${getStatusText(booking.status)}</span></td>
                        <td>
                            <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="viewBookingDetails('${booking.id}')">
                                Details
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Ausstehend';
                case 'confirmed': return 'Best√§tigt';
                case 'cancelled': return 'Abgelehnt';
                default: return status;
            }
        }
        
        // BOOKING FUNCTIONS
        async function loadBookings() {
            try {
                const tableBody = document.getElementById('bookingsTable');
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem;"><div class="loading-spinner"></div>Lade Buchungen...</td></tr>';
                
                const bookingsSnapshot = await getDocs(collection(db, 'bookings'));
                currentBookings = bookingsSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                if (currentBookings.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">Keine Buchungen vorhanden</td></tr>';
                    return;
                }
                
                // Sort by timestamp descending
                currentBookings.sort((a, b) => b.timestamp?.toDate() - a.timestamp?.toDate());
                
                tableBody.innerHTML = currentBookings.map(booking => {
                    const statusClass = booking.status === 'pending' ? 'status-pending' : 
                                      booking.status === 'confirmed' ? 'status-confirmed' : 'status-cancelled';
                    
                    const personenText = `${booking.erwachsene || 0}E + ${booking.kinder || 0}K`;
                    
                    return `
                        <tr>
                            <td>${booking.id.substring(0, 8)}...</td>
                            <td>${booking.vorname} ${booking.nachname}</td>
                            <td>${booking.email}</td>
                            <td>${booking.anreise} - ${booking.abreise} (${booking.naechte || 'N/A'} N√§chte)</td>
                            <td>${personenText}</td>
                            <td>‚Ç¨${booking.gesamtpreis || 'N/A'}</td>
                            <td><span class="status-badge ${statusClass}">${getStatusText(booking.status)}</span></td>
                            <td>
                                <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="viewBookingDetails('${booking.id}')">
                                    Details
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading bookings:', error);
                document.getElementById('bookingsTable').innerHTML = '<tr><td colspan="8" style="text-align: center; color: red;">Fehler beim Laden der Buchungen</td></tr>';
            }
        }
        
        async function viewBookingDetails(bookingId) {
            console.log('Loading booking details for:', bookingId);
            
            // Find booking in current bookings or load fresh data
            let booking = currentBookings.find(b => b.id === bookingId);
            
            if (!booking) {
                // If not found in current bookings, try to load it directly
                try {
                    const bookingDoc = await doc(db, 'bookings', bookingId);
                    const bookingSnapshot = await getDoc(bookingDoc);
                    if (bookingSnapshot.exists()) {
                        booking = { id: bookingSnapshot.id, ...bookingSnapshot.data() };
                    }
                } catch (error) {
                    console.error('Error loading booking directly:', error);
                }
            }
            
            if (!booking) {
                alert('Buchung nicht gefunden. Bitte aktualisieren Sie die Seite.');
                return;
            }
            
            console.log('Booking data:', booking);
            
            const modalContent = document.getElementById('bookingModalContent');
            if (!modalContent) {
                console.error('Modal content element not found');
                return;
            }
            
            // Format dates properly
            const formatDate = (dateStr) => {
                if (!dateStr) return 'N/A';
                try {
                    return new Date(dateStr).toLocaleDateString('de-DE');
                } catch {
                    return dateStr;
                }
            };
            
            modalContent.innerHTML = `
                <h3>Buchungsdetails - ${booking.vorname || 'N/A'} ${booking.nachname || 'N/A'}</h3>
                <div style="margin: 1rem 0;">
                    <h4 style="margin-bottom: 0.5rem; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem;">Pers√∂nliche Daten</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.5rem; padding: 0.5rem 0;">
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Name:</span><span style="color: var(--text-dark); margin-left: 10px;">${booking.vorname || 'N/A'} ${booking.nachname || 'N/A'}</span></div>
                        <div><span style="font-weight: 600; color: var(--secondary-color);">E-Mail:</span><span style="color: var(--text-dark); margin-left: 10px;">${booking.email || 'N/A'}</span></div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.5rem; padding: 0.5rem 0;">
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Telefon:</span><span style="color: var(--text-dark); margin-left: 10px;">${booking.telefon || 'N/A'}</span></div>
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Status:</span><span style="color: var(--text-dark); margin-left: 10px;">${getStatusText(booking.status)}</span></div>
                    </div>
                    
                    <h4 style="margin-bottom: 0.5rem; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem;">Buchungsdetails</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.5rem; padding: 0.5rem 0;">
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Anreise:</span><span style="color: var(--text-dark); margin-left: 10px;">${formatDate(booking.anreise)}</span></div>
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Abreise:</span><span style="color: var(--text-dark); margin-left: 10px;">${formatDate(booking.abreise)}</span></div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.5rem; padding: 0.5rem 0;">
                        <div><span style="font-weight: 600; color: var(--secondary-color);">N√§chte:</span><span style="color: var(--text-dark); margin-left: 10px;">${booking.naechte || 'N/A'}</span></div>
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Gesamtpreis:</span><span style="color: var(--text-dark); margin-left: 10px;">‚Ç¨${booking.gesamtpreis || 'N/A'}</span></div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.5rem; padding: 0.5rem 0;">
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Erwachsene:</span><span style="color: var(--text-dark); margin-left: 10px;">${booking.erwachsene || 'N/A'}</span></div>
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Kinder:</span><span style="color: var(--text-dark); margin-left: 10px;">${booking.kinder || '0'}</span></div>
                    </div>
                    
                    <h4 style="margin-bottom: 0.5rem; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem;">Besondere W√ºnsche</h4>
                    <p style="padding: 0.5rem; background: #f8f9fa; border-radius: 5px; margin: 0.5rem 0;">${booking['besondere-wuensche'] || booking.wuensche || 'Keine besonderen W√ºnsche'}</p>
                    
                    <h4 style="margin-bottom: 0.5rem; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem;">Einverst√§ndniserkl√§rungen</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 0.5rem; padding: 0.5rem 0;">
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Marketing:</span><span style="color: var(--text-dark); margin-left: 10px;">${booking.videoConsent || booking['video-consent'] ? 'Ja' : 'Nein'}</span></div>
                        <div><span style="font-weight: 600; color: var(--secondary-color);">Video√ºberwachung:</span><span style="color: var(--text-dark); margin-left: 10px;">${booking.videoSurveillanceConsent || booking['video-surveillance-consent'] ? 'Ja' : 'Nein'}</span></div>
                    </div>
                    
                    <h4 style="margin-bottom: 0.5rem; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem;">Personalausweise</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                        ${booking.personalausweisUrls && booking.personalausweisUrls.length > 0 ? 
                            booking.personalausweisUrls.map((url, index) => `
                                <div style="position: relative; width: 150px; height: 100px; border-radius: 5px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                    <img src="${url}" alt="Personalausweis ${index + 1}" style="width: 100%; height: 100%; object-fit: cover;">
                                    <button style="position: absolute; top: 5px; right: 5px; background: rgba(255,255,255,0.8); border: none; border-radius: 3px; padding: 3px 6px; cursor: pointer; font-size: 0.7rem;" onclick="showImageModal('${url}')">üîç</button>
                                </div>
                            `).join('') : 
                            '<p style="padding: 0.5rem; background: #fff3cd; border-radius: 5px; color: #856404;">Keine Personalausweise hochgeladen</p>'
                        }
                    </div>
                    
                    ${booking.status === 'pending' ? `
                    <div style="background: var(--light-gray); padding: 1.5rem; border-radius: var(--border-radius); margin-top: 2rem;">
                        <h4 style="margin-bottom: 1rem; color: var(--primary-color);">Auf Buchungsanfrage antworten</h4>
                        <div class="form-group">
                            <label for="responseMessage">Nachricht an den Gast:</label>
                            <textarea id="responseMessage" rows="4" placeholder="Schreiben Sie hier Ihre Nachricht an den Gast..." style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-success" style="flex: 1; min-width: 120px;" onclick="respondToBooking('${booking.id}', 'confirmed')">
                                ‚úÖ Buchung annehmen
                            </button>
                            <button class="btn btn-danger" style="flex: 1; min-width: 120px;" onclick="respondToBooking('${booking.id}', 'cancelled')">
                                ‚ùå Buchung ablehnen
                            </button>
                        </div>
                    </div>
                    ` : booking.responseMessage ? `
                    <div style="background: var(--light-gray); padding: 1.5rem; border-radius: var(--border-radius); margin-top: 2rem;">
                        <h4 style="margin-bottom: 1rem; color: var(--primary-color);">Gesendete Antwort</h4>
                        <p style="padding: 0.5rem; background: white; border-radius: 5px;">${booking.responseMessage}</p>
                    </div>
                    ` : ''}
                </div>
            `;
            
            const bookingModal = document.getElementById('bookingModal');
            if (bookingModal) {
                bookingModal.classList.add('active');
                console.log('Modal opened successfully');
            } else {
                console.error('Booking modal element not found');
            }
        }
        
        async function respondToBooking(bookingId, newStatus) {
            const responseMessage = document.getElementById('responseMessage')?.value || '';
            
            if (!responseMessage.trim()) {
                alert('Bitte geben Sie eine Nachricht f√ºr den Gast ein.');
                return;
            }
            
            const confirmText = newStatus === 'confirmed' ? 
                'M√∂chten Sie diese Buchung wirklich annehmen?' : 
                'M√∂chten Sie diese Buchung wirklich ablehnen?';
                
            if (!confirm(confirmText)) {
                return;
            }
            
            try {
                // Update booking status in Firestore
                await updateDoc(doc(db, 'bookings', bookingId), {
                    status: newStatus,
                    responseMessage: responseMessage,
                    respondedAt: serverTimestamp(),
                    updatedAt: serverTimestamp()
                });
                
                // Update local data
                const booking = currentBookings.find(b => b.id === bookingId);
                if (booking) {
                    booking.status = newStatus;
                    booking.responseMessage = responseMessage;
                }
                
                // Send email notification
                try {
                    await sendEmailNotification(bookingId, newStatus, responseMessage);
                } catch (emailError) {
                    console.error('Error sending email notification:', emailError);
                    // Don't fail the whole operation if email fails
                }
                
                // Refresh displays
                loadBookings();
                loadDashboardData();
                closeBookingModal();
                
                const actionText = newStatus === 'confirmed' ? 'angenommen' : 'abgelehnt';
                alert(`Buchung wurde ${actionText}. Eine E-Mail-Benachrichtigung wurde an den Gast gesendet.`);
                
            } catch (error) {
                console.error('Error updating booking status:', error);
                alert('Fehler beim Aktualisieren des Status: ' + error.message);
            }
        }
        
        // Email notification function
        async function sendEmailNotification(bookingId, status, message) {
            try {
                // Find the booking
                let booking = currentBookings.find(b => b.id === bookingId);
                
                if (!booking) {
                    console.error('Booking not found in currentBookings, trying to fetch directly...');
                    const bookingDoc = await getDoc(doc(db, 'bookings', bookingId));
                    if (bookingDoc.exists()) {
                        booking = { id: bookingDoc.id, ...bookingDoc.data() };
                    } else {
                        console.error('Booking not found in database either');
                        return;
                    }
                }
                
                const statusText = status === 'confirmed' ? 'angenommen' : 'abgelehnt';
                const subject = `Buchungsanfrage ${statusText} - Architektenhaus am Wald`;
                
                const emailBody = `Liebe/r ${booking.vorname} ${booking.nachname},

Ihre Buchungsanfrage f√ºr das Architektenhaus am Wald wurde ${statusText}.

Buchungsdetails:
- Anreise: ${booking.anreise}
- Abreise: ${booking.abreise}
- Personen: ${booking.erwachsene} Erwachsene + ${booking.kinder || 0} Kinder

Nachricht von uns:
${message}

Bei Fragen k√∂nnen Sie uns gerne kontaktieren:
E-Mail: inga.weyrauch@gmail.com
Telefon: +49 173 706 34 21

Mit freundlichen Gr√º√üen
Inga & Familie
Architektenhaus am Wald`;
                
                // Create email data for logging/future implementation
                const emailData = {
                    to: booking.email,
                    subject: subject,
                    body: emailBody,
                    bookingId: bookingId,
                    status: status,
                    timestamp: serverTimestamp(),
                    processed: false
                };
                
                // Store email for later processing (could be processed by a cloud function)
                await addDoc(collection(db, 'emailQueue'), emailData);
                
                console.log('Email notification queued:', emailData);
                
                // **SOFORTIGE E-MAIL √ñFFNUNG**
                const mailtoLink = `mailto:${booking.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;
                
                // Automatisch E-Mail-Client √∂ffnen
                window.open(mailtoLink, '_blank');
                
                // Info f√ºr Admin
                alert(`E-Mail-Client wurde ge√∂ffnet. Bitte senden Sie die E-Mail an ${booking.email} manuell ab.

F√ºr automatische E-Mails ben√∂tigen Sie:
1. EmailJS (kostenlos, einfach)
2. SendGrid API (professionell)
3. Firebase Cloud Functions (automatisiert)

Die E-Mail wurde auch in der emailQueue gespeichert.`);
                
            } catch (error) {
                console.error('Error sending email notification:', error);
                alert('Fehler beim Erstellen der E-Mail-Benachrichtigung: ' + error.message);
                throw error;
            }
        }

        // ** E-MAIL SETUP ANLEITUNG **
        function showEmailSetupInstructions() {
            const instructions = `
üîß E-MAIL AUTOMATISIERUNG EINRICHTEN

Derzeit werden E-Mails manuell √ºber Ihren E-Mail-Client gesendet.
F√ºr automatische E-Mails haben Sie folgende Optionen:

üìß OPTION 1: EmailJS (Empfohlen f√ºr Einsteiger)
1. Konto erstellen: https://www.emailjs.com/
2. E-Mail Service verbinden (Gmail/Outlook)
3. Template erstellen
4. API Key in Code einbauen
‚Üí Kostenlos bis 200 E-Mails/Monat

üìß OPTION 2: SendGrid (Professionell)
1. Konto erstellen: https://sendgrid.com/
2. API Key generieren
3. Domain verifizieren
4. Code anpassen
‚Üí Kostenpflichtig, sehr zuverl√§ssig

üìß OPTION 3: Firebase Cloud Functions (Automatisiert)
1. Firebase Blaze Plan aktivieren
2. Cloud Function erstellen
3. SendGrid/Nodemailer integrieren
4. emailQueue automatisch abarbeiten
‚Üí Vollautomatisch, skalierbar

Soll ich Ihnen bei der Einrichtung helfen?
            `;
            
            if (confirm(instructions + '\n\nM√∂chten Sie die Anleitung per E-Mail erhalten?')) {
                const mailtoLink = `mailto:inga.weyrauch@gmail.com?subject=E-Mail Automatisierung Setup&body=${encodeURIComponent(instructions)}`;
                window.open(mailtoLink, '_blank');
            }
        }
        
        function closeBookingModal() {
            document.getElementById('bookingModal').classList.remove('active');
        }
        
        function showImageModal(imageUrl) {
            document.getElementById('modalImage').src = imageUrl;
            document.getElementById('imageModal').classList.add('active');
        }
        
        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }
        
        // CONTENT MANAGEMENT
        async function loadContentData() {
            try {
                const contentSnapshot = await getDocs(collection(db, 'content'));
                
                console.log('Loading content data...');
                
                contentSnapshot.forEach(doc => {
                    const data = doc.data();
                    console.log('Content document:', doc.id, data);
                    
                    if (data.type === 'hero') {
                        const heroTitle = document.getElementById('heroTitle');
                        const heroSubtitle = document.getElementById('heroSubtitle');
                        const currentHeroImage = document.getElementById('currentHeroImage');
                        const noHeroImage = document.getElementById('noHeroImage');
                        
                        if (heroTitle) heroTitle.value = data.title || '';
                        if (heroSubtitle) heroSubtitle.value = data.subtitle || '';
                        
                        // Load hero background image
                        if (data.backgroundImage && currentHeroImage && noHeroImage) {
                            console.log('Loading hero image:', data.backgroundImage);
                            currentHeroImage.src = data.backgroundImage;
                            currentHeroImage.style.display = 'block';
                            noHeroImage.style.display = 'none';
                            
                            // Store current image URL for reference
                            currentHeroImage.dataset.currentUrl = data.backgroundImage;
                        } else if (currentHeroImage && noHeroImage) {
                            currentHeroImage.style.display = 'none';
                            noHeroImage.style.display = 'block';
                        }
                    } else if (data.type === 'about') {
                        const aboutTitle = document.getElementById('aboutTitle');
                        const aboutParagraph1 = document.getElementById('aboutParagraph1');
                        const aboutParagraph2 = document.getElementById('aboutParagraph2');
                        const aboutParagraph3 = document.getElementById('aboutParagraph3');
                        const aboutSignature = document.getElementById('aboutSignature');
                        
                        if (aboutTitle) aboutTitle.value = data.title || '';
                        if (aboutParagraph1) aboutParagraph1.value = data.paragraph1 || '';
                        if (aboutParagraph2) aboutParagraph2.value = data.paragraph2 || '';
                        if (aboutParagraph3) aboutParagraph3.value = data.paragraph3 || '';
                        if (aboutSignature) aboutSignature.value = data.signature || '';
                    }
                });
                
            } catch (error) {
                console.error('Error loading content data:', error);
                alert('Fehler beim Laden der Inhalte: ' + error.message);
            }
        }
        
        // Hero Image Upload
        async function uploadHeroImage(input) {
            const file = input.files[0];
            if (!file) return;
            
            console.log('Starting hero image upload:', file.name);
            
            const uploadProgress = document.getElementById('heroImageUploadProgress');
            if (uploadProgress) {
                uploadProgress.style.display = 'block';
            }
            
            try {
                const timestamp = Date.now();
                const fileName = `hero/hero_${timestamp}_${file.name}`;
                const storageRef = ref(storage, fileName);
                
                console.log('Uploading to:', fileName);
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);
                console.log('Upload successful, URL:', downloadURL);
                
                // Get current form values
                const heroTitle = document.getElementById('heroTitle');
                const heroSubtitle = document.getElementById('heroSubtitle');
                
                // Update hero content with new background image
                const heroData = {
                    type: 'hero',
                    title: heroTitle ? heroTitle.value : 'Architektenhaus am Wald',
                    subtitle: heroSubtitle ? heroSubtitle.value : 'Modernste Technologie trifft auf nachhaltiges Design',
                    backgroundImage: downloadURL,
                    updatedAt: serverTimestamp()
                };
                
                console.log('Saving hero data:', heroData);
                await setDoc(doc(db, 'content', 'hero'), heroData);
                
                // Update UI immediately
                const currentHeroImage = document.getElementById('currentHeroImage');
                const noHeroImage = document.getElementById('noHeroImage');
                
                if (currentHeroImage && noHeroImage) {
                    currentHeroImage.src = downloadURL;
                    currentHeroImage.style.display = 'block';
                    noHeroImage.style.display = 'none';
                    currentHeroImage.dataset.currentUrl = downloadURL;
                    console.log('UI updated with new image');
                }
                
                if (uploadProgress) {
                    uploadProgress.style.display = 'none';
                }
                input.value = '';
                alert('Hauptbild erfolgreich hochgeladen und gespeichert!');
                
                // Force reload of content data to verify
                setTimeout(() => {
                    loadContentData();
                }, 1000);
                
            } catch (error) {
                console.error('Error uploading hero image:', error);
                if (uploadProgress) {
                    uploadProgress.style.display = 'none';
                }
                alert('Fehler beim Hochladen des Bildes: ' + error.message);
            }
        }
        
        // Hero Form Handler
        document.getElementById('heroForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const heroData = {
                    type: 'hero',
                    title: document.getElementById('heroTitle').value,
                    subtitle: document.getElementById('heroSubtitle').value,
                    updatedAt: serverTimestamp()
                };
                
                // Keep existing background image if available
                const currentImage = document.getElementById('currentHeroImage').src;
                if (currentImage && !currentImage.includes('data:image')) {
                    heroData.backgroundImage = currentImage;
                }
                
                await setDoc(doc(db, 'content', 'hero'), heroData);
                alert('Hero-Bereich erfolgreich gespeichert!');
                
            } catch (error) {
                console.error('Error saving hero content:', error);
                alert('Fehler beim Speichern');
            }
        });
        
        // About Form Handler
        document.getElementById('aboutForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const aboutData = {
                    type: 'about',
                    title: document.getElementById('aboutTitle').value,
                    paragraph1: document.getElementById('aboutParagraph1').value,
                    paragraph2: document.getElementById('aboutParagraph2').value,
                    paragraph3: document.getElementById('aboutParagraph3').value,
                    signature: document.getElementById('aboutSignature').value,
                    updatedAt: serverTimestamp()
                };
                
                await setDoc(doc(db, 'content', 'about'), aboutData);
                alert('√úber uns Bereich erfolgreich gespeichert!');
                
            } catch (error) {
                console.error('Error saving about content:', error);
                alert('Fehler beim Speichern');
            }
        });
        
        // GALLERY MANAGEMENT
        async function loadGalleryData() {
            try {
                const galleryGrid = document.getElementById('adminGalleryGrid');
                galleryGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;"><div class="loading-spinner"></div>Lade Galerie...</div>';
                
                const gallerySnapshot = await getDocs(query(collection(db, 'gallery'), orderBy('order', 'asc')));
                currentGalleryImages = gallerySnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                if (currentGalleryImages.length === 0) {
                    galleryGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">Keine Bilder vorhanden</div>';
                    return;
                }
                
                galleryGrid.innerHTML = currentGalleryImages.map(image => `
                    <div class="gallery-item">
                        <img src="${image.url}" alt="${image.title}" onclick="showImageModal('${image.url}')">
                        <div class="gallery-item-content">
                            <div class="gallery-item-header">
                                <h4>${image.title}</h4>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" onclick="deleteGalleryImage('${image.id}')">üóëÔ∏è</button>
                            </div>
                            <p>${image.description}</p>
                            <small>Reihenfolge: ${image.order}</small>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="editGalleryImage('${image.id}')">‚úèÔ∏è Bearbeiten</button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading gallery:', error);
            }
        }
        
        async function uploadGalleryImages(input) {
            const files = Array.from(input.files);
            if (files.length === 0) return;
            
            const uploadProgress = document.getElementById('uploadProgress');
            uploadProgress.style.display = 'block';
            
            try {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const timestamp = Date.now();
                    const fileName = `gallery/${timestamp}_${file.name}`;
                    const storageRef = ref(storage, fileName);
                    
                    const snapshot = await uploadBytes(storageRef, file);
                    const downloadURL = await getDownloadURL(snapshot.ref);
                    
                    // Get next order number
                    const nextOrder = currentGalleryImages.length + i + 1;
                    
                    // Add to Firestore
                    await addDoc(collection(db, 'gallery'), {
                        title: file.name.split('.')[0],
                        description: 'Neues Galerie-Bild - Beschreibung hier bearbeiten',
                        url: downloadURL,
                        order: nextOrder,
                        createdAt: serverTimestamp()
                    });
                }
                
                uploadProgress.style.display = 'none';
                input.value = '';
                loadGalleryData();
                alert('Bilder erfolgreich hochgeladen!');
                
            } catch (error) {
                console.error('Error uploading images:', error);
                uploadProgress.style.display = 'none';
                alert('Fehler beim Hochladen');
            }
        }
        
        async function editGalleryImage(imageId) {
            const image = currentGalleryImages.find(img => img.id === imageId);
            if (!image) return;
            
            const modalContent = document.getElementById('galleryEditModalContent');
            modalContent.innerHTML = `
                <h3>Galerie-Bild bearbeiten</h3>
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="${image.url}" alt="${image.title}" style="max-width: 300px; max-height: 200px; object-fit: cover; border-radius: 8px;">
                </div>
                <form id="galleryEditForm" onsubmit="saveGalleryImageEdit(event, '${imageId}')">
                    <div class="form-group">
                        <label for="editImageTitle">Titel:</label>
                        <input type="text" id="editImageTitle" value="${image.title}" required>
                    </div>
                    <div class="form-group">
                        <label for="editImageDescription">Beschreibung:</label>
                        <textarea id="editImageDescription" rows="3" required>${image.description}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="editImageOrder">Reihenfolge:</label>
                        <input type="number" id="editImageOrder" value="${image.order}" min="1" required>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeGalleryEditModal()">Abbrechen</button>
                        <button type="submit" class="btn btn-success">üíæ Speichern</button>
                    </div>
                </form>
            `;
            
            document.getElementById('galleryEditModal').classList.add('active');
        }
        
        async function saveGalleryImageEdit(event, imageId) {
            event.preventDefault();
            
            try {
                const title = document.getElementById('editImageTitle').value;
                const description = document.getElementById('editImageDescription').value;
                const order = parseInt(document.getElementById('editImageOrder').value);
                
                await updateDoc(doc(db, 'gallery', imageId), {
                    title: title,
                    description: description,
                    order: order,
                    updatedAt: serverTimestamp()
                });
                
                closeGalleryEditModal();
                loadGalleryData();
                alert('Galerie-Bild erfolgreich aktualisiert!');
                
            } catch (error) {
                console.error('Error updating gallery image:', error);
                alert('Fehler beim Speichern');
            }
        }
        
        function closeGalleryEditModal() {
            document.getElementById('galleryEditModal').classList.remove('active');
        }
        
        async function deleteGalleryImage(imageId) {
            if (!confirm('Bild wirklich l√∂schen?')) return;
            
            try {
                const image = currentGalleryImages.find(img => img.id === imageId);
                if (image && image.url) {
                    // Delete from Storage
                    const imageRef = ref(storage, image.url);
                    await deleteObject(imageRef).catch(() => {}); // Ignore errors if file doesn't exist
                }
                
                // Delete from Firestore
                await deleteDoc(doc(db, 'gallery', imageId));
                
                loadGalleryData();
                alert('Bild erfolgreich gel√∂scht!');
                
            } catch (error) {
                console.error('Error deleting image:', error);
                alert('Fehler beim L√∂schen');
            }
        }
        
        // FEATURES MANAGEMENT
        async function loadFeaturesData() {
            try {
                const featuresList = document.getElementById('featuresList');
                featuresList.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;"><div class="loading-spinner"></div>Lade Features...</div>';
                
                const featuresSnapshot = await getDocs(query(collection(db, 'features'), orderBy('order', 'asc')));
                currentFeatures = featuresSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                
                if (currentFeatures.length === 0) {
                    featuresList.innerHTML = '<div style="text-align: center; padding: 2rem; color: #666;">Keine Features vorhanden</div>';
                    return;
                }
                
                featuresList.innerHTML = currentFeatures.map(feature => `
                    <div style="background: #f8f9fa; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 1.5rem; margin-right: 1rem;">${feature.icon}</span>
                            <strong>${feature.title}</strong>
                            <p style="margin: 0.5rem 0; color: #666;">${feature.description}</p>
                            <small>Reihenfolge: ${feature.order}</small>
                        </div>
                        <button class="btn btn-danger" onclick="deleteFeature('${feature.id}')">üóëÔ∏è L√∂schen</button>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading features:', error);
            }
        }
        
        // Feature Form Handler
        document.getElementById('featureForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const featureData = {
                    icon: document.getElementById('featureIcon').value,
                    title: document.getElementById('featureTitle').value,
                    description: document.getElementById('featureDescription').value,
                    order: parseInt(document.getElementById('featureOrder').value),
                    createdAt: serverTimestamp()
                };
                
                await addDoc(collection(db, 'features'), featureData);
                
                // Reset form
                this.reset();
                document.getElementById('featureOrder').value = currentFeatures.length + 2;
                
                loadFeaturesData();
                alert('Feature erfolgreich hinzugef√ºgt!');
                
            } catch (error) {
                console.error('Error adding feature:', error);
                alert('Fehler beim Hinzuf√ºgen');
            }
        });
        
        async function deleteFeature(featureId) {
            if (!confirm('Feature wirklich l√∂schen?')) return;
            
            try {
                await deleteDoc(doc(db, 'features', featureId));
                loadFeaturesData();
                alert('Feature erfolgreich gel√∂scht!');
                
            } catch (error) {
                console.error('Error deleting feature:', error);
                alert('Fehler beim L√∂schen');
            }
        }
        
        // UTILITY FUNCTIONS
        function refreshDashboard() {
            loadDashboardData();
        }
        
        function exportBookings() {
            if (currentBookings.length === 0) {
                alert('Keine Buchungen zum Exportieren vorhanden');
                return;
            }
            
            const csvContent = "data:text/csv;charset=utf-8," 
                + "ID,Vorname,Nachname,Email,Telefon,Anreise,Abreise,Erwachsene,Kinder,Preis,Status,Datum,Nachricht\n"
                + currentBookings.map(booking => {
                    const date = booking.timestamp?.toDate().toLocaleDateString('de-DE') || '';
                    const responseMessage = booking.responseMessage || '';
                    return `"${booking.id}","${booking.vorname}","${booking.nachname}","${booking.email}","${booking.telefon}","${booking.anreise}","${booking.abreise}","${booking.erwachsene}","${booking.kinder}","${booking.gesamtpreis}","${booking.status}","${date}","${responseMessage}"`;
                }).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `buchungen_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const bookingModal = document.getElementById('bookingModal');
            const imageModal = document.getElementById('imageModal');
            const galleryEditModal = document.getElementById('galleryEditModal');
            
            if (e.target === bookingModal) {
                closeBookingModal();
            }
            if (e.target === imageModal) {
                closeImageModal();
            }
            if (e.target === galleryEditModal) {
                closeGalleryEditModal();
            }
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const bookingModal = document.getElementById('bookingModal');
                const imageModal = document.getElementById('imageModal');
                const galleryEditModal = document.getElementById('galleryEditModal');
                
                if (bookingModal.classList.contains('active')) {
                    closeBookingModal();
                }
                if (imageModal.classList.contains('active')) {
                    closeImageModal();
                }
                if (galleryEditModal.classList.contains('active')) {
                    closeGalleryEditModal();
                }
            }
        });
        
        // Auto-resize textareas
        document.addEventListener('input', (e) => {
            if (e.target.tagName === 'TEXTAREA') {
                e.target.style.height = 'auto';
                e.target.style.height = e.target.scrollHeight + 'px';
            }
        });
        
        // Initialize drag and drop for file uploads
        function initializeDragAndDrop() {
            const uploadAreas = document.querySelectorAll('.image-upload');
            
            uploadAreas.forEach(area => {
                area.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    area.style.borderColor = 'var(--primary-color)';
                    area.style.backgroundColor = 'var(--light-gray)';
                });
                
                area.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    area.style.borderColor = '#ddd';
                    area.style.backgroundColor = 'transparent';
                });
                
                area.addEventListener('drop', (e) => {
                    e.preventDefault();
                    area.style.borderColor = '#ddd';
                    area.style.backgroundColor = 'transparent';
                    
                    const files = Array.from(e.dataTransfer.files);
                    const input = area.querySelector('input[type="file"]');
                    
                    if (input && files.length > 0) {
                        // Create a new FileList
                        const dt = new DataTransfer();
                        files.forEach(file => dt.items.add(file));
                        input.files = dt.files;
                        
                        // Trigger change event
                        input.dispatchEvent(new Event('change', { bubbles: true }));
                    }
                });
            });
        }
        
        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            initializeDragAndDrop();
            console.log('üéØ Admin Dashboard initialized');
        });
        
        // Make functions globally available
        window.refreshDashboard = refreshDashboard;
        window.loadBookings = loadBookings;
        window.exportBookings = exportBookings;
        window.viewBookingDetails = viewBookingDetails;
        window.respondToBooking = respondToBooking;
        window.closeBookingModal = closeBookingModal;
        window.showImageModal = showImageModal;
        window.closeImageModal = closeImageModal;
        window.uploadGalleryImages = uploadGalleryImages;
        window.uploadHeroImage = uploadHeroImage;
        window.deleteGalleryImage = deleteGalleryImage;
        window.editGalleryImage = editGalleryImage;
        window.saveGalleryImageEdit = saveGalleryImageEdit;
        window.closeGalleryEditModal = closeGalleryEditModal;
        window.deleteFeature = deleteFeature;
        
        console.log('‚úÖ Admin Dashboard loaded successfully');
        
    </script>
</body>
</html><!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Architektenhaus am Wald</title>
    <meta name="description" content="Content Management System f√ºr Architektenhaus am Wald">
    <meta name="robots" content="noindex, nofollow">
    
    <style>
        :root {
            --primary-color: #333;
            --secondary-color: #666;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --white: #ffffff;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --text-dark: #333;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--light-gray);
        }
        
        /* Login Form */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }
        
        .login-form {
            background: var(--white);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            max-width: 400px;
            width: 100%;
        }
        
        .login-form h2 {
            text-align: center;
            color: var(--text-dark);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-dark);
            font-weight: 500;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(51, 51, 51, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: var(--white);
        }
        
        .btn-success {
            background: var(--success-color);
            color: var(--white);
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: var(--text-dark);
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: var(--white);
        }
        
        .btn-secondary {
            background: var(--secondary-color);
            color: var(--white);
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .error-message {
            color: var(--danger-color);
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
            min-height: 100vh;
        }
        
        .admin-dashboard.active {
            display: block;
        }
        
        /* Header */
        .admin-header {
            background: var(--primary-color);
            color: var(--white);
            padding: 20px 0;
            box-shadow: var(--shadow);
        }
        
        .admin-header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-header h1 {
            font-size: 1.8rem;
            color: var(--white);
        }
        
        /* Navigation */
        .admin-nav {
            background: var(--white);
            padding: 20px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .admin-nav .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .nav-tabs {
            display: flex;
            gap: 20px;
            list-style: none;
            flex-wrap: wrap;
        }
        
        .nav-tabs a {
            display: block;
            padding: 10px 20px;
            text-decoration: none;
            color: var(--text-dark);
            border: 2px solid transparent;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .nav-tabs a:hover,
        .nav-tabs a.active {
            background: var(--primary-color);
            color: var(--white);
        }
        
        /* Content */
        .admin-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .card-header {
            background: var(--primary-color);
            color: var(--white);
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: var(--white);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .stat-card h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-dark);
        }
        
        /* Tables */
        .table-container {
            background: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .table-header {
            background: var(--primary-color);
            color: var(--white);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-header h3 {
            margin: 0;
            color: var(--white);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: var(--light-gray);
            font-weight: 600;
            color: var(--text-dark);
        }
        
        tr:hover {
            background: rgba(44, 85, 48, 0.05);
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-confirmed {
            background: var(--success-color);
            color: var(--white);
        }
        
        .status-pending {
            background: var(--warning-color);
            color: var(--text-dark);
        }
        
        .status-cancelled {
            background: var(--danger-color);
            color: var(--white);
        }
        
        /* Image Upload */
        .image-upload {
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--light-gray);
        }
        
        .image-upload:hover {
            border-color: var(--primary-color);
            background: rgba(51, 51, 51, 0.05);
        }
        
        .image-upload input {
            display: none;
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }
        
        .current-hero-image {
            max-width: 300px;
            max-height: 200px;
            object-fit: cover;
            border-radius: var(--border-radius);
            margin: 1rem 0;
        }
        
        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .gallery-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
        }
        
        .gallery-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .gallery-item-content {
            padding: 15px;
        }
        
        .gallery-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .gallery-item h4 {
            margin: 0;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        .gallery-item p {
            font-size: 0.9rem;
            color: #666;
            margin: 5px 0;
        }
        
        .gallery-item small {
            color: #999;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
            border-left: 4px solid;
        }
        
        .alert-success {
            background: #d4edda;
            border-color: var(--success-color);
            color: #155724;
        }
        
        .alert-warning {
            background: #fff3cd;
            border-color: var(--warning-color);
            color: #856404;
        }
        
        .alert-danger {
            background: #f8d7da;
            border-color: var(--danger-color);
            color: #721c24;
        }
        
        .alert-info {
            background: #d1ecf1;
            border-color: var(--info-color);
            color: #0c5460;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .admin-header .container {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .gallery-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div class="login-container" id="loginContainer">
        <form class="login-form" id="loginForm">
            <h2>üîê Admin Login</h2>
            <div class="form-group">
                <label for="username">Benutzername:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Passwort:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Anmelden</button>
            <div class="error-message" id="loginErrorMessage"></div>
        </form>
    </div>
    
    <!-- Admin Dashboard -->
    <div class="admin-dashboard" id="adminDashboard">
        <!-- Header -->
        <header class="admin-header">
            <div class="container">
                <h1>üè° CMS - Architektenhaus am Wald</h1>
                <div>
                    <button class="btn btn-danger" id="logoutBtn">Abmelden</button>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="admin-nav">
            <div class="container">
                <ul class="nav-tabs">
                    <li><a href="#dashboard" class="nav-link active">üìä Dashboard</a></li>
                    <li><a href="#bookings" class="nav-link">üìÖ Buchungen</a></li>
                    <li><a href="#content" class="nav-link">üìù Inhalte</a></li>
                    <li><a href="#gallery" class="nav-link">üì∏ Galerie</a></li>
                    <li><a href="#features" class="nav-link">‚≠ê Features</a></li>
                </ul>
            </div>
        </nav>
        
        <!-- Content -->
        <main class="admin-content">
            
            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">
                <h2>Dashboard √úbersicht</h2>
                
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="icon">üìÖ</div>
                        <h3>Buchungen</h3>
                        <div class="number" id="totalBookings">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">‚è≥</div>
                        <h3>Ausstehend</h3>
                        <div class="number" id="pendingBookings">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">‚úÖ</div>
                        <h3>Best√§tigt</h3>
                        <div class="number" id="confirmedBookings">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">‚ùå</div>
                        <h3>Abgelehnt</h3>
                        <div class="number" id="cancelledBookings">-</div>
                    </div>
                </div>
                
                <!-- Recent Bookings -->
                <div class="table-container">
                    <div class="table-header">
                        <h3>Neueste Buchungen</h3>
                        <button class="btn btn-primary" onclick="refreshDashboard()">üîÑ Aktualisieren</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Datum</th>
                                <th>Name</th>
                                <th>E-Mail</th>
                                <th>Zeitraum</th>
                                <th>Personen</th>
                                <th>Preis</th>
                                <th>Status</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="recentBookingsTable">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 2rem;">
                                    <div class="loading-spinner"></div>
                                    Lade Buchungen...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Bookings Tab -->
            <div class="tab-content" id="bookings">
                <h2>Buchungsverwaltung</h2>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3>Alle Buchungen</h3>
                        <div>
                            <button class="btn btn-success" onclick="exportBookings()">üìÑ Exportieren</button>
                            <button class="btn btn-primary" onclick="loadBookings()">üîÑ Aktualisieren</button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>E-Mail</th>
                                <th>Zeitraum</th>
                                <th>Personen</th>
                                <th>Preis</th>
                                <th>Status</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="bookingsTable">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 2rem;">
                                    <div class="loading-spinner"></div>
                                    Lade Buchungen...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Content Tab -->
            <div class="tab-content" id="content">
                <h2>Inhalte verwalten</h2>
                
                <!-- Hero Section -->
                <div class="card">
                    <div class="card-header">
                        Hero-Bereich bearbeiten
                    </div>
                    <div class="card-body">
                        <!-- Current Hero Image Display -->
                        <div class="form-group">
                            <label>Aktuelles Hauptbild:</label>
                            <div id="currentHeroImageContainer">
                                <img id="currentHeroImage" class="current-hero-image" src="" alt="Aktuelles Hauptbild" style="display: none;">
                                <p id="noHeroImage" style="color: #666; font-style: italic;">Noch kein Hauptbild hochgeladen</p>
                            </div>
                        </div>
                        
                        <!-- Hero Image Upload -->
                        <div class="form-group">
                            <label>Neues Hauptbild hochladen:</label>
                            <div class="image-upload" onclick="document.getElementById('heroImageInput').click()">
                                <input type="file" id="heroImageInput" accept="image/*" onchange="uploadHeroImage(this)">
                                <div class="upload-icon">üñºÔ∏è</div>
                                <p>Klicken Sie hier um das Hauptbild zu √§ndern</p>
                                <small>JPG/PNG - Empfohlene Gr√∂√üe: 1200x800px</small>
                            </div>
                            <div id="heroImageUploadProgress" style="display: none;">
                                <div class="alert alert-info">
                                    <div class="loading-spinner"></div>
                                    Bild wird hochgeladen...
                                </div>
                            </div>
                        </div>
                        
                        <form id="heroForm">
                            <div class="form-group">
                                <label for="heroTitle">Haupttitel:</label>
                                <input type="text" id="heroTitle" placeholder="Architektenhaus am Wald">
                            </div>
                            <div class="form-group">
                                <label for="heroSubtitle">Untertitel:</label>
                                <textarea id="heroSubtitle" placeholder="Modernste Technologie trifft auf nachhaltiges Design..."></textarea>
                            </div>
                            <button type="submit" class="btn btn-success">üíæ Hero-Bereich speichern</button>
                        </form>
                    </div>
                </div>
                
                <!-- About Section -->
                <div class="card">
                    <div class="card-header">
                        √úber uns - Bereich bearbeiten
                    </div>
                    <div class="card-body">
                        <form id="aboutForm">
                            <div class="form-group">
                                <label for="aboutTitle">Titel:</label>
                                <input type="text" id="aboutTitle" placeholder="Unsere Vision">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="aboutParagraph1">Erster Absatz:</label>
                                    <textarea id="aboutParagraph1" rows="4"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="aboutParagraph2">Zweiter Absatz:</label>
                                    <textarea id="aboutParagraph2" rows="4"></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="aboutParagraph3">Dritter Absatz:</label>
                                    <textarea id="aboutParagraph3" rows="4"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="aboutSignature">Signatur:</label>
                                    <input type="text" id="aboutSignature" placeholder="Inga & Familie">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success">üíæ √úber uns speichern</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Gallery Tab -->
            <div class="tab-content" id="gallery">
                <h2>Galerie verwalten</h2>
                
                <!-- Upload New Images -->
                <div class="card">
                    <div class="card-header">
                        Neue Bilder hochladen
                    </div>
                    <div class="card-body">
                        <div class="image-upload" onclick="document.getElementById('galleryImageInput').click()">
                            <input type="file" id="galleryImageInput" accept="image/*" multiple onchange="uploadGalleryImages(this)">
                            <div class="upload-icon">üñºÔ∏è</div>
                            <p>Klicken Sie hier um Galerie-Bilder hochzuladen</p>
                            <small>Mehrere Dateien m√∂glich - JPG/PNG</small>
                        </div>
                        <div id="uploadProgress" style="display: none;">
                            <div class="alert alert-info">
                                <div class="loading-spinner"></div>
                                Bilder werden hochgeladen...
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gallery Management -->
                <div class="card">
                    <div class="card-header">
                        Galerie-Bilder verwalten
                    </div>
                    <div class="card-body">
                        <div class="gallery-grid" id="adminGalleryGrid">
                            <div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #666;">
                                <div class="loading-spinner"></div>
                                Lade Galerie...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Features Tab -->
            <div class="tab-content" id="features">
                <h2>Features verwalten</h2>
                
                <!-- Add New Feature -->
                <div class="card">
                    <div class="card-header">
                        Neues Feature hinzuf√ºgen
                    </div>
                    <div class="card-body">
                        <form id="featureForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="featureIcon">Icon:</label>
                                    <input type="text" id="featureIcon" placeholder="üèä‚Äç‚ôÇÔ∏è" maxlength="10">
                                </div>
                                <div class="form-group">
                                    <label for="featureOrder">Reihenfolge:</label>
                                    <input type="number" id="featureOrder" min="1" value="1">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="featureTitle">Titel:</label>
                                <input type="text" id="featureTitle" placeholder="Pool & Sauna" required>
                            </div>
                            <div class="form-group">
                                <label for="featureDescription">Beschreibung:</label>
                                <textarea id="featureDescription" rows="3" placeholder="Entspannen Sie im beheizten Pool..." required></textarea>
                            </div>
                            <button type="submit" class="btn btn-success">‚ûï Feature hinzuf√ºgen</button>
                        </form>
                    </div>
                </div>
                
                <!-- Features List -->
                <div class="card">
                    <div class="card-header">
                        Alle Features
                    </div>
                    <div class="card-body">
                        <div id="featuresList">
                            <div style="text-align: center; padding: 2rem; color: #666;">
                                <div class="loading-spinner"></div>
                                Lade Features...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </main>
    </div>
    
    <!-- Booking Details Modal -->
    <div class="modal" id="bookingModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeBookingModal()">√ó</button>
            <div id="bookingModalContent"></div>
        </div>
    </div>
    
 <button class="close-btn" onclick="closeGalleryEditModal()">√ó</button>
            <div id="galleryEditModalContent"></div>
        </div>
    </div>
    
    <!-- Image Modal -->
    <div class="modal" id="imageModal">
        <div class="close-btn" onclick="closeImageModal()">√ó</div>
        <img id="modalImage" src="" alt="Vergr√∂√üerte Ansicht" style="max-width: 90%; max-height: 90%; object-fit: contain;">
    </div>